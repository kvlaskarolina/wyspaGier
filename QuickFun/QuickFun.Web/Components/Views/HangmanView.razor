@using QuickFun.Games.Hangman
@namespace QuickFun.Web.Components.Views

<div class="hangman-container">
    @if (Engine == null)
    {
        <p>≈Åadowanie gry...</p>
    }
    else
    {
        <div class="hangman-box">
            <pre class="hangman-picture">@Engine.HangmanPicture</pre>
        </div>

        <p class="status-msg">@Engine.Message</p>

        <div class="word-display">
            @foreach (var c in Engine.CurrentGuess)
            {
                <span class="letter-box">@c</span>
            }
        </div>

        <div class="letters-grid">
            @foreach (var letter in letters)
            {
                var l = letter;
                <button class="btn-letter"
                        @onclick="() => HandleGuess(l)"
                        disabled="@(UsedLetters.Contains(l) || Engine.IsGameOver)">
                    @l
                </button>
            }
        </div>
    }
</div>

@code {
    [Parameter] 
    public HangmanEngine? Engine { get; set; }

    private char[] letters = "abcdefghijklmnopqrstuvwxyz".ToCharArray();
    private HashSet<char> UsedLetters = new HashSet<char>();

    protected override void OnParametersSet()
    {
        if (Engine != null && Engine.GuessedLetters.Count == 0)
        {
            UsedLetters.Clear();
        }
    }

    private void HandleGuess(char letter)
    {
        if (Engine == null || Engine.IsGameOver) return;

        UsedLetters.Add(letter);
        Engine.MakeMove(letter);
        
        StateHasChanged();
    }
}

<style>
    .hangman-container {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .hangman-picture {
        font-family: 'Courier New', monospace;
        font-size: 1.2rem;
        line-height: 1.1;
        background: #222;
        color: #0f0;
        padding: 20px;
        border-radius: 8px;
        white-space: pre;
        text-align: left;
        border: 2px solid #ccc;
    }

    .status-msg {
        font-size: 1.2rem;
        margin: 15px 0;
        min-height: 1.5rem;
        color: #444;
    }

    .word-display {
        margin-bottom: 30px;
    }

    .letter-box {
        font-size: 2.2rem;
        margin: 0 5px;
        display: inline-block;
        width: 1.2em;
        border-bottom: 3px solid #ccc;
        text-transform: uppercase;
        font-weight: bold;
    }

    .letters-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        max-width: 500px;
    }

    .btn-letter {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
        font-weight: bold;
        background: #f0f0f0;
        border: 2px solid #ccc;
        border-radius: 6px;
        cursor: pointer;
        text-transform: uppercase;
        transition: background 0.2s;
    }

    .btn-letter:hover:not(:disabled) {
        background: #e0e0e0;
    }

    .btn-letter:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }
</style>