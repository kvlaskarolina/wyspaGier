@using QuickFun.Games.Engines
@using QuickFun.Domain.Enums
@using QuickFun.Application.Interfaces
@using QuickFun.Domain.Entities
@inject IGameSessionService SessionService

@namespace QuickFun.Web.Components.Views

<div class="game-container">
    <p class="status-message">@Engine.Message</p>

    <div class="board">
        @for (int i = 0; i < 9; i++)
        {
            int localIndex = i;
            <button class="cell @(Engine.Board[i] != '\0' ? "occupied" : "")" @onclick="() => HandleClick(localIndex)"
                disabled="@Engine.IsGameOver">
                @Engine.Board[i]
            </button>
        }
    </div>
</div>

@code {
    [Parameter]
    public TicTacToeEngine Engine { get; set; }

    private async Task HandleClick(int index)
    {
        if (Engine == null || Engine.IsGameOver) return;

        Engine.MakeMove(index);

        if (Engine.IsGameOver)
        {
            await SessionService.AddGameResultAsync(new GameResult
            {
                Type = Engine.Type,
                Score = Engine.Score
            });
        }
    }
}

<style>
    .board {
        display: grid;
        grid-template-columns: repeat(3, 100px);
        gap: 10px;
        justify-content: center;
        margin: 20px auto;
    }

    .cell {
        width: 100px;
        height: 100px;
        font-size: 2.5rem;
        font-weight: bold;
        cursor: pointer;
        background: #f0f0f0;
        border: 2px solid #ccc;
        border-radius: 8px;
    }

    .status-message {
        font-size: 1.5rem;
        color: #333;
        height: 2rem;
        text-align: center;
    }
</style>