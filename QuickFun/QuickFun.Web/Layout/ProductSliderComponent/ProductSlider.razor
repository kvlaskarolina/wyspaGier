@using QuickFun.Domain.Enums
@using Microsoft.JSInterop
@implements IDisposable
@inject IJSRuntime JS

<div class="slider-container">
    <div class="slider-wrapper" @ref="sliderRef" @onscroll="HandleScroll">
        @foreach (var item in sampleGames)
        {
            <div class="slide-item">
                <div class="card game-card">
                    <div class="card-img">
                        <img src="@(item.ImageUrl ?? "/images/games/brain-circuit.svg")" alt="@item.Name" />
                    </div>
                    <div class="card-body">
                        <h3>@item.Name</h3>
                        <p class="category">@item.Category</p>
                        <NavLink class="nav-link" href=@item.href>
                            <button class="btn-play">Graj teraz</button>
                        </NavLink>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="slider-dots">
        @for (int i = 0; i < sampleGames.Count; i++)
        {
            var index = i;
            <span class="dot @(currentIdx == index ? "active" : "")" @onclick="() => ManualScrollToIndex(index)"></span>
        }
    </div>
</div>

@code {
    private ElementReference sliderRef;
    private int currentIdx = 0;
    private System.Threading.Timer? timer;

    public class GameItem
    {
        public int Id { get; set; }
        public string Name { get; set; } = "";
        public string Category { get; set; } = "";
        public string href { get; set; } = "";
        public string? ImageUrl { get; set; }
    }

    private List<GameItem> sampleGames = new()
{
new GameItem { Id = 1, Name = "Memory", Category = "Logic", ImageUrl = "/images/games/memory.png", href="/game/memory"},
new GameItem { Id = 2, Name = "Tic Tac Toe", Category = "Strategy", ImageUrl = "/images/games/tictactoe.png",
href="/game/tictactoe" },
new GameItem { Id = 3, Name = "Sudoku", Category = "Logic", ImageUrl = "/images/games/sudoku.png", href="/game/sudoku"
},
new GameItem { Id = 4, Name = "Minesweeper", Category = "Classic", ImageUrl = "/images/games/minesweeper.png",
href="/game/minesweeper" },
new GameItem { Id = 5, Name = "Tic Tac Toe vs AI", Category = "Strategy", ImageUrl = "/images/games/tictactoeAI.png",
href="/game/tictactoewithai" },
new GameItem { Id = 6, Name = "Hangman", Category = "Word", href="/game/hangman", ImageUrl = "/images/games/hangman.png"
}
};

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            timer = new System.Threading.Timer(async _ =>
            {
                await InvokeAsync(async () =>
    {
                currentIdx = (currentIdx + 1) % sampleGames.Count;
                await ScrollToIndex(currentIdx);
                StateHasChanged();
            });
            }, null, 3000, 3000);
        }
    }

    private async Task ManualScrollToIndex(int index)
    {
        timer?.Change(3000, 3000);
        await ScrollToIndex(index);
    }

    private async Task ScrollToIndex(int index)
    {
        currentIdx = index;
        await JS.InvokeVoidAsync("eval", $@"
var el = document.querySelector('.slider-wrapper');
if(el) {{
var item = el.querySelector('.slide-item');
if(item) {{
var itemWidth = item.offsetWidth;
el.scrollTo({{ left: {index} * (itemWidth + 20), behavior: 'smooth' }});
}}
}}
");
    }

    private void HandleScroll(EventArgs e) { }

    public void Dispose() => timer?.Dispose();
}

<style>
    .slider-container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 0;
        position: relative;
    }

    .slider-wrapper {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        gap: 20px;
        padding: 20px 10px;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .slider-wrapper::-webkit-scrollbar {
        display: none;
    }

    .slide-item {
        flex: 0 0 calc(33.333% - 14px);
        scroll-snap-align: center;
        display: flex;
        justify-content: center;
    }

    .card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        width: 100%;
        max-width: 320px;
        box-shadow: 0 4px 15px rgba(217, 109, 109, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-bottom: 6px solid transparent;
        display: flex;
        flex-direction: column;
    }

    .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 0 24px 0 #ff68b4, 0 8px 32px 0 rgba(111, 78, 55, 0.25);
        border-bottom: 6px solid #ff68b4;
    }

    .card-img {
        height: 200px;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card-img img {
        max-height: 90%;
        max-width: 90%;
        object-fit: contain;
    }

    .card-body {
        padding: 1.5rem;
        text-align: center;
    }

    .card-body h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: #333;
        font-weight: bold;
    }

    .category {
        color: #ff94ca;
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-play {
        background: #ff68b4;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        font-weight: bold;
        transition: background 0.2s;
    }

    .btn-play:hover {
        background: #ff68b4;
    }

    .slider-dots {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 20px;
    }

    .dot {
        width: 10px;
        height: 10px;
        background: #ccc;
        border-radius: 50%;
        cursor: pointer;
    }

    .dot.active {
        background: #ff68b4;
    }

    @@media (max-width: 1024px) {
        .slide-item {
            flex: 0 0 calc(50% - 10px);
        }
    }

    @@media (max-width: 768px) {
        .slide-item {
            flex: 0 0 100%;
        }
    }
</style>