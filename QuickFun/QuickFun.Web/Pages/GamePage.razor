@page "/game/{GameTypeString}"
@using QuickFun.Domain.Enums
@using QuickFun.Games
@using QuickFun.Games.Engines
@using QuickFun.Application.Interfaces
@inject IGameFactory GameFactory
@inject IGameSessionService SessionService

<div class="game-layout">
    @if (CurrentGame == null)
    {
        <p>Ładowanie gry...</p>
    }
    else
    {
        <h1>@CurrentGame.Name</h1>

        @* SEKCJA DYNAMICZNA: Tutaj sprawdzamy, co wyprodukowała fabryka *@

        @if (CurrentGame is TicTacToeEngine ttt)
        {
            <div class="status">@ttt.Message</div>
            <div class="ttt-board">
                @for (int i = 0; i < 9; i++)
                {
                    int index = i;
                    <button class="cell" @onclick="() => HandleTicTacToeMove(ttt, index)" disabled="@ttt.IsGameOver">
                        @ttt.Board[i]
                    </button>
                }
            </div>
        }
        else if (CurrentGame is SnakeEngine snake)
        {
            @* Tutaj w przyszłości dodasz widok Snake'a *@
            <div class="snake-placeholder">
                Gra Snake w budowie! Twój wynik: @snake.Score
            </div>
        }

        <div class="controls">
            <button class="btn" @onclick="Reset">Restart</button>
            <a href="/" class="btn btn-secondary">Powrót do menu</a>
        </div>
    }
</div>

@code {
    [Parameter] public string GameTypeString { get; set; }
    private IGameEngine CurrentGame { get; set; }

    // Ta metoda wykonuje się, gdy wejdziesz na stronę lub zmienisz parametr w URL
    protected override void OnParametersSet()
    {
        if (Enum.TryParse<GameType>(GameTypeString, true, out var type))
        {
            // FABRYKA: Tworzy odpowiedni silnik na podstawie parametru z URL
            CurrentGame = GameFactory.CreateGame(type);
        }
    }

    private async Task HandleTicTacToeMove(TicTacToeEngine engine, int index)
    {
        engine.MakeMove(index);

    }

    private void Reset() => CurrentGame?.Reset();
}

<style>
    .game-layout {
        text-align: center;
        max-width: 500px;
        margin: 2rem auto;
    }

    .ttt-board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin: 1rem 0;
    }

    .cell {
        height: 100px;
        font-size: 2rem;
        background: white;
        border: 2px solid #333;
        border-radius: 8px;
    }

    .btn {
        padding: 10px 20px;
        cursor: pointer;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
    }

    .btn-secondary {
        background: #6c757d;
        text-decoration: none;
        margin-left: 10px;
        display: inline-block;
    }
</style>